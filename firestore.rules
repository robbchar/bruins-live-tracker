/*
 In general follow the pattern where each application has a /APP-NAMESPACE with specific rules underneath
*/
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Global deny-all fallback
    match /{document=**} {
      allow read, write: if false;
    }

    // application-tracker
    match /application-tracker {
      match /{applicationId} {
        allow read, update, delete: if request.auth != null &&
          resource.data.userId == request.auth.uid;
        allow create: if request.auth != null &&
          request.resource.data.userId == request.auth.uid;
      }
    }

    // show-tracker namespace
    match /show-tracker {
      // Per-user doc (e.g., profile, settings, pin) and subcollections.
      match /{uid} {
        allow read, write: if request.auth != null && request.auth.uid == uid;

        // User shows
        match /shows/{id} {
          allow read, write: if request.auth != null && request.auth.uid == uid;

          match /episodes/{episodeId} {
            allow read, write: if request.auth != null && request.auth.uid == uid;
          }
        }
      }

      // Shared show cache under `cache/shows/{id}` (read-only to clients).
      match /cache {
        match /shows/{id} {
          allow read: if true;
          allow write: if false;
          match /episodes/{episodeId} {
            allow read: if true;
            allow write: if false;
          }
        }
      }
    }

    // katas
    match /katas {
      match /{kataId} {
        allow read: if true;
        allow write: if request.auth != null;
      }
    }

    // cache_recipes
    match /cache_recipes {
      match /{rid} {
        allow read: if true;
        allow write: if false;
      }
    }

    // bruinsLive namespace
    match /bruinsLive {
      // Public config and today pointer can be read by clients.
      match /config/public {
        allow read: if true;
        allow write: if false;
      }

      match /today/{dateKey} {
        allow read: if true;
        allow write: if false;
      }

      // Default deny for all other Bruins Live docs.
      match /{document=**} {
        allow read, write: if false;
      }
    }
  }
}
